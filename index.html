<!doctype html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.1.3/dist/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
    <link rel="stylesheet" type="text/css" href="style.css">

    <title>Mini Project</title>
    
    <!-- Analytics Tracking Script -->
<!-- Analytics Tracking Script - Add to any website -->
<script>
  // Analytics Client Script
  (function() {
    // IMPORTANT: Change this to your actual analytics server URL
    const TRACKING_SERVER = 'https://your-analytics-server-url.com';
    
    // Generate a unique visitor ID or retrieve existing one
    function getVisitorId() {
        let visitorId = localStorage.getItem('visitor_tracker_id');
        if (!visitorId) {
            visitorId = 'v' + Math.random().toString(36).substring(2, 15) + 
                        Math.random().toString(36).substring(2, 15);
            localStorage.setItem('visitor_tracker_id', visitorId);
        }
        return visitorId;
    }

    // Track page visit
    function trackPageView() {
        try {
            const visitorId = getVisitorId();
            const timestamp = new Date().toISOString();
            const currentUrl = window.location.href;
            const path = window.location.pathname;
            const referrer = document.referrer;
            const userAgent = navigator.userAgent;
            const screenWidth = window.screen.width;
            const screenHeight = window.screen.height;
            
            const visitData = {
                visitor_id: visitorId,
                timestamp: timestamp,
                url: currentUrl,
                path: path,
                referrer: referrer,
                user_agent: userAgent,
                screen_width: screenWidth,
                screen_height: screenHeight,
                event_type: 'page_view'
            };

            // Console log for debugging
            console.log('Sending tracking data:', visitData);

            // Send tracking data to server
            fetch(`${TRACKING_SERVER}/api/track`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(visitData),
                // Use these options to allow cross-origin requests
                mode: 'cors',
                credentials: 'omit'
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error('Failed to send tracking data');
                }
                console.log('Visit tracking successful');
            })
            .catch(error => {
                console.error('Error sending tracking data:', error);
                // Fallback to tracking pixel
                sendTrackingPixel(visitData);
            });
        } catch (e) {
            console.error('Error in tracking script:', e);
        }
    }

    // Fallback method using tracking pixel
    function sendTrackingPixel(visitData) {
        try {
            const encodedData = encodeURIComponent(JSON.stringify(visitData));
            const img = new Image();
            img.src = `${TRACKING_SERVER}/api/track-pixel?data=${encodedData}`;
            img.style.display = 'none';
            document.body.appendChild(img);
        } catch (e) {
            console.error('Error sending tracking pixel:', e);
        }
    }

    // Track visit duration
    let startTime = Date.now();
    function trackDuration() {
        if (!document.hidden) {
            const visitorId = getVisitorId();
            const duration = Math.floor((Date.now() - startTime) / 1000);
            
            if (duration > 5) { // Only track if spent more than 5 seconds
                fetch(`${TRACKING_SERVER}/api/track`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        visitor_id: visitorId,
                        timestamp: new Date().toISOString(),
                        event_type: 'duration',
                        duration: duration
                    }),
                    mode: 'cors',
                    credentials: 'omit'
                }).catch(e => console.error('Error sending duration data:', e));
            }
        }
    }

    // Track when page loads
    window.addEventListener('load', function() {
        setTimeout(trackPageView, 300); // Small delay to ensure page is fully loaded
    });

    // Track duration when leaving the page
    window.addEventListener('beforeunload', trackDuration);
    
    // Track duration when tab becomes invisible
    document.addEventListener('visibilitychange', function() {
        if (document.hidden) {
            trackDuration();
        } else {
            // Reset timer when tab becomes visible again
            startTime = Date.now();
        }
    });

    // Check if document is already loaded
    if (document.readyState === 'complete') {
        trackPageView();
    }
  })();
</script>
  </head>
  <body style="background-image: url('bg_img.png');">
      <ul class="topnav">
        <li><a class="active" href="#home">Home</a></li>
        <li><a href="rating.html">Ratings</a></li>
        <li><a href="resume.html">Create Resume</a></li>
    </ul>
    
    <section class="column">
      <a href="masud.html">
        <img src="KMC.png" width="500px" height="500px">
      </a>
      <div id="faraz">
        <a href="https://faraz6188.github.io/Portfolio/">
          <img src="MFA.png" width="500px" height="500px">
        </a>
      </div>
    </section>
    <h1 style="color: wheat;">A website with Simple resume generator, 5 Star Ratings & reviews and Views counter</h1>

    <button class="info" onclick="showViews()">Show total Views</button>
    <div id="view-counter"></div>

    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.14.3/dist/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.1.3/dist/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>
    
    <script>
    function showViews() {
      fetch('/api/analytics')
        .then(response => response.json())
        .then(data => {
          const viewCount = data.length;
          const uniqueVisitors = new Set(data.map(visit => visit.visitor_id)).size;
          
          document.getElementById('view-counter').innerHTML = 
            `<div class="alert alert-success mt-3">
              <p>Total page views: <strong>${viewCount}</strong></p>
              <p>Unique visitors: <strong>${uniqueVisitors}</strong></p>
            </div>`;
        })
        .catch(error => {
          console.error('Error fetching view count:', error);
          document.getElementById('view-counter').innerHTML = 
            `<div class="alert alert-danger mt-3">Failed to fetch view count</div>`;
        });
    }
    </script>

    <footer style="color: wheat;">
      Copyright Â© 2020 | Mini Project of MGM's CEN | Powered by Mohammed Faraz Ali & Khalid Masud Chaudhary
    </footer>
  </body>
</html>
